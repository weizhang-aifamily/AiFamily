<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å…¨å®¶è¥å…»èœå• Â· æ™ºèƒ½ç‰ˆ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; }
body { background: #f5f5f5; color: #333; line-height: 1.6; }
.header { background: #2ecc71; color: #fff; padding: 15px; text-align: center; font-size: 18px; position: relative; }
.card { background: #fff; margin: 12px; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.btn { display: block; width: 100%; padding: 12px; border: none; border-radius: 8px; background: #2ecc71; color: #fff; font-size: 16px; margin-top: 8px; text-align: center; cursor: pointer; transition: all 0.3s; }
.btn:disabled { background: #bdc3c7; cursor: not-allowed; }
.btn-secondary { background: #95a5a6; }
.btn-small { padding: 6px 10px; font-size: 12px; display: inline-flex; align-items: center; }
.btn-icon { margin-right: 5px; }
ul { list-style: none; padding-left: 0; }
li { margin: 10px 0; display: flex; justify-content: space-between; align-items: center; }
.progress-container { display: flex; align-items: center; gap: 8px; width: 70%; }
.progress-bar { height: 8px; border-radius: 4px; background: #e0e0e0; flex-grow: 1; overflow: hidden; }
.progress { height: 100%; }
.nutrient-tag { font-size: 12px; padding: 2px 6px; border-radius: 4px; margin-left: 4px; }
.protein { background: #ffecec; color: #e74c3c; }
.fiber { background: #fff5e6; color: #f39c12; }
.calcium { background: #e6f3ff; color: #3498db; }
.sodium { background: #e8f8f0; color: #2ecc71; }
.ai-tag { background: #e8f8f0; color: #2ecc71; font-size: 12px; padding: 2px 8px; border-radius: 4px; margin-bottom: 5px; display: inline-block; }
.recipe-cards { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px; }
.recipe-card { min-width: 160px; padding: 12px; border-radius: 8px; background: #f9f9f9; flex-shrink: 0; }
.bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; padding: 10px; background: #fff; border-top: 1px solid #eee; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
.bottom-bar .btn { margin: 0; }
.tutorial { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; padding: 20px; }
.tutorial-content { max-width: 300px; text-align: center; }
.tutorial-steps { margin: 20px 0; }
.tutorial-close { margin-top: 20px; padding: 8px 20px; background: #2ecc71; border: none; border-radius: 20px; color: white; }
.food-item { display: flex; align-items: center; gap: 8px; }
.food-icon { font-size: 18px; }
.empty-state { color: #95a5a6; text-align: center; padding: 20px 0; }
</style>
</head>
<body>
<div class="header">
  ä»Šæ—¥å…¨å®¶èœå• Â· <span id="personText">4</span> äºº
  <button class="btn-small" style="position: absolute; right: 15px; top: 15px; background: rgba(255,255,255,0.2);" onclick="showTutorial()">?</button>
</div>

<!-- æ–°æ‰‹å¼•å¯¼æµ®å±‚ 
<div id="tutorial" class="tutorial hidden">
  <div class="tutorial-content">
    <h3>ä½¿ç”¨æŒ‡å—</h3>
    <div class="tutorial-steps">
      <p>1. æŸ¥çœ‹ä»Šæ—¥è¥å…»ç¼ºå£</p>
      <p>2. é€‰æ‹©AIæ¨èèœè°±</p>
      <p>3. ç”Ÿæˆå®Œæ•´èœå•</p>
    </div>
    <button class="tutorial-close" onclick="hideTutorial()">æˆ‘çŸ¥é“äº†</button>
  </div>
</div>
-->
<!-- â‘  ä»Šæ—¥è¥å…»ç›®æ ‡ -->
<div class="card">
  <h3>ä»Šæ—¥è¥å…»ç›®æ ‡</h3>
  <ul>
    <li>
      <div class="food-item">
        <span class="food-icon">ğŸ—</span>
        <span>è›‹ç™½è´¨</span>
        <span class="nutrient-tag protein" id="gapProtein">+25g</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div id="progProtein" class="progress" style="width:0%;background:#e74c3c"></div>
        </div>
        <button class="btn-small btn-secondary" onclick="openFoodModal('protein')">æ·»åŠ </button>
      </div>
    </li>
    <li>
      <div class="food-item">
        <span class="food-icon">ğŸ¥¦</span>
        <span>è†³é£Ÿçº¤ç»´</span>
        <span class="nutrient-tag fiber" id="gapFiber">+8g</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div id="progFiber" class="progress" style="width:0%;background:#f39c12"></div>
        </div>
        <button class="btn-small btn-secondary" onclick="openFoodModal('fiber')">æ·»åŠ </button>
      </div>
    </li>
    <li>
      <div class="food-item">
        <span class="food-icon">ğŸ¥›</span>
        <span>é’™</span>
        <span class="nutrient-tag calcium" id="gapCalcium">+200mg</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div id="progCalcium" class="progress" style="width:0%;background:#3498db"></div>
        </div>
        <button class="btn-small btn-secondary" onclick="openFoodModal('calcium')">æ·»åŠ </button>
      </div>
    </li>
    <li>
      <div class="food-item">
        <span class="food-icon">ğŸ§‚</span>
        <span>é’ </span>
        <span class="nutrient-tag sodium" id="gapSodium">80%</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div id="progSodium" class="progress" style="width:80%;background:#2ecc71"></div>
        </div>
        <button class="btn-small btn-secondary" onclick="openFoodModal('sodium')">æ·»åŠ </button>
      </div>
    </li>
  </ul>
</div>

<!-- â‘¡ AI æ¨èèœè°± -->
<div class="card">
  <h3>AI æ¨èèœè°±</h3>
  <div class="recipe-cards">
    <div class="recipe-card">
      <div class="ai-tag">AIæ¨è</div>
      <strong>é•¿é«˜ç‰ˆ</strong>
      <p>ğŸ— é¸¡èƒ¸ 120g<br>ğŸ¥¦ è¥¿å…°èŠ± 150g</p>
      <button class="btn" id="r0" onclick="addRecipe('é•¿é«˜ç‰ˆ',['é¸¡èƒ¸ 120 g','è¥¿å…°èŠ± 150 g'],this)">
        <span class="btn-icon">â•</span> åŠ å…¥èœå•
      </button>
    </div>
    <div class="recipe-card">
      <div class="ai-tag">AIæ¨è</div>
      <strong>æŠ—æ°§åŒ–ç‰ˆ</strong>
      <p>ğŸ¥‘ ç‰›æ²¹æœ 80g<br>ğŸ« è“è“ 100g</p>
      <button class="btn" id="r1" onclick="addRecipe('æŠ—æ°§åŒ–ç‰ˆ',['ç‰›æ²¹æœ 80 g','è“è“ 100 g'],this)">
        <span class="btn-icon">â•</span> åŠ å…¥èœå•
      </button>
    </div>
    <div class="recipe-card">
      <div class="ai-tag">AIæ¨è</div>
      <strong>éšå½¢è”¬èœç‰ˆ</strong>
      <p>ğŸ” è”¬èœç‰›è‚‰é¥¼ 120g<br>ğŸ… ç•ªèŒ„é…± 20g</p>
      <button class="btn" id="r2" onclick="addRecipe('éšå½¢è”¬èœç‰ˆ',['è”¬èœç‰›è‚‰é¥¼ 120 g','ç•ªèŒ„é…± 20 g'],this)">
        <span class="btn-icon">â•</span> åŠ å…¥èœå•
      </button>
    </div>
  </div>
  <button class="btn btn-secondary" style="margin-top: 12px;" onclick="showCustomFood()">
    <span class="btn-icon">ğŸ”</span> æ‰¾ä¸åˆ°æƒ³è¦çš„ï¼Ÿæ‰‹åŠ¨æ·»åŠ é£Ÿæ
  </button>
</div>

<!-- â‘¢ å·²é€‰é£Ÿæ -->
<div class="card">
  <h3>å·²é€‰é£Ÿæ</h3>
  <ul id="recipeList">
    <li class="empty-state">æš‚æ— é£Ÿæï¼Œè¯·ä»ä¸Šæ–¹æ·»åŠ </li>
  </ul>
</div>

<!-- â‘£ ä»Šæ—¥èœè°± -->
<div class="card">
  <h3>ä»Šæ—¥èœè°±</h3>
  <div id="todayRecipe" class="empty-state">æš‚æ— èœè°±ï¼Œè¯·å…ˆé€‰æ‹©é£Ÿæ</div>
</div>

<!-- åº•éƒ¨æ“ä½œæ  -->
<div class="bottom-bar">
  <button class="btn" id="generateBtn" onclick="generateRecipe()" disabled>ç”Ÿæˆå®Œæ•´èœè°±</button>
</div>

<script>
/* ========= å¸¸é‡ ========= */
const TARGET = { protein: 70, fiber: 20, calcium: 1000, sodium: 1500 };
const FOOD = {
  'é¸¡èƒ¸ 120 g': { protein: 23, fiber: 0, calcium: 8, sodium: 65 },
  'è¥¿å…°èŠ± 150 g': { protein: 5, fiber: 5, calcium: 50, sodium: 20 },
  'ç‰›æ²¹æœ 80 g': { protein: 2, fiber: 5, calcium: 15, sodium: 10 },
  'è“è“ 100 g': { protein: 1, fiber: 2, calcium: 10, sodium: 5 },
  'è”¬èœç‰›è‚‰é¥¼ 120 g': { protein: 25, fiber: 3, calcium: 20, sodium: 40 },
  'ç•ªèŒ„é…± 20 g': { protein: 0, fiber: 1, calcium: 2, sodium: 1 }
};
let selected = [];
let usedRecipes = new Set();

/* ========= æ–°æ‰‹å¼•å¯¼ ========= */
function showTutorial() {
  document.getElementById('tutorial').classList.remove('hidden');
}
function hideTutorial() {
  document.getElementById('tutorial').classList.add('hidden');
}

/* ========= å®æ—¶ç¼ºå£ & è¿›åº¦ ========= */
function updateGap() {
  let total = { protein: 0, fiber: 0, calcium: 0, sodium: 0 };
  selected.forEach(f => Object.keys(total).forEach(k => total[k] += f[k]));
  
  Object.keys(total).forEach(k => {
    const gap = TARGET[k] - total[k];
    const ratio = Math.min(100, (total[k] / TARGET[k]) * 100);
    const displayGap = k === 'calcium' ? `${gap.toFixed(0)}mg` : 
                      k === 'sodium' ? `${ratio.toFixed(0)}%` : `${gap.toFixed(1)}g`;
    
    document.getElementById(`gap${k[0].toUpperCase() + k.slice(1)}`).innerText = displayGap;
    document.getElementById(`prog${k[0].toUpperCase() + k.slice(1)}`).style.width = `${ratio}%`;
  });

  // æ›´æ–°ç”ŸæˆæŒ‰é’®çŠ¶æ€
  document.getElementById('generateBtn').disabled = selected.length === 0;
}

/* ========= é£Ÿæå¼¹å±‚ ========= */
function openFoodModal(type) { 
  alert(`å°†æ‰“å¼€${type}é£Ÿæé€‰æ‹©å¼¹å±‚ï¼ˆæ­¤å¤„ä¸ºç¤ºä¾‹ï¼Œå®é™…éœ€å®ç°å¼¹å±‚é€»è¾‘ï¼‰`); 
}
function showCustomFood() {
  alert("å°†å±•å¼€æ‰‹åŠ¨æ·»åŠ é£Ÿæç•Œé¢ï¼ˆæ­¤å¤„ä¸ºç¤ºä¾‹ï¼‰");
}

/* ========= æ·»åŠ /åˆ é™¤é£Ÿæ ========= */
function addFood(name) {
  selected.push({ name, ...FOOD[name] });
  renderList();
  updateGap();
  generateRecipe();
}

function removeFood(index) {
  selected.splice(index, 1);
  renderList();
  updateGap();
  generateRecipe();
}

/* ========= æ·»åŠ èœè°± ========= */
function addRecipe(name, items, btn) {
  if (usedRecipes.has(name)) return;
  
  items.forEach(item => {
    if (!selected.find(s => s.name === item)) {
      selected.push({ name: item, ...FOOD[item] });
    }
  });
  
  usedRecipes.add(name);
  btn.disabled = true;
  btn.innerHTML = '<span class="btn-icon">âœ”ï¸</span> å·²æ·»åŠ ';
  btn.classList.add('btn-secondary');
  
  renderList();
  updateGap();
  generateRecipe();
}

/* ========= æ¸²æŸ“åˆ—è¡¨ ========= */
function renderList() {
  const ul = document.getElementById('recipeList');
  ul.innerHTML = '';
  
  if (selected.length === 0) {
    ul.innerHTML = '<li class="empty-state">æš‚æ— é£Ÿæï¼Œè¯·ä»ä¸Šæ–¹æ·»åŠ </li>';
    return;
  }
  
  selected.forEach((item, idx) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <div class="food-item">
        <span>${item.name}</span>
      </div>
      <button class="btn-small btn-secondary" onclick="removeFood(${idx})">
        <span class="btn-icon">âœ•</span> åˆ é™¤
      </button>
    `;
    ul.appendChild(li);
  });
}

/* ========= ç”Ÿæˆèœè°± ========= */
function generateRecipe() {
  const names = selected.map(s => s.name);
  const recipeEl = document.getElementById('todayRecipe');
  
  if (names.length === 0) {
    recipeEl.innerHTML = '<div class="empty-state">æš‚æ— èœè°±ï¼Œè¯·å…ˆé€‰æ‹©é£Ÿæ</div>';
  } else {
    recipeEl.innerHTML = `
      <ul style="padding-left: 15px;">
        ${names.map(item => `<li>${item}</li>`).join('')}
      </ul>
      <p style="margin-top: 10px; color: #2ecc71;">âœ”ï¸ è¥å…»å‡è¡¡åº¦: ${calculateScore()}%</p>
    `;
  }
}

function calculateScore() {
  // ç®€åŒ–çš„è¥å…»è¯„åˆ†é€»è¾‘ï¼ˆå®é™…åº”æ ¹æ®ç¼ºå£è®¡ç®—ï¼‰
  return Math.min(100, Math.floor(selected.length * 15 + 30));
}

/* ========= åˆå§‹åŒ– ========= */
document.addEventListener('DOMContentLoaded', () => {
  renderList();
  updateGap();
  // é¦–æ¬¡è®¿é—®æ˜¾ç¤ºå¼•å¯¼
  if (!localStorage.getItem('tutorialShown')) {
    hideTutorial();
    //localStorage.setItem('tutorialShown', 'true');
  }
});
</script>
</body>
</html>