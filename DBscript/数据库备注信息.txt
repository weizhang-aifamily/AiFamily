-- 用户相关表
ALTER TABLE `ejia_app_user` COMMENT 'APP用户表（微信/手机用户）';
ALTER TABLE `ejia_user_family` COMMENT '用户家庭成员信息表';

-- 菜品管理表
ALTER TABLE `ejia_dish` COMMENT '菜品基本信息表';
ALTER TABLE `ejia_dish_category` COMMENT '菜品分类字典表';
ALTER TABLE `ejia_combo` COMMENT '套餐模板表';
ALTER TABLE `ejia_combo_item` COMMENT '套餐-菜品关联表';

-- 食材营养表
ALTER TABLE `ejia_ingredient` COMMENT '食材营养成分明细表';
ALTER TABLE `ejia_ingredient_category` COMMENT '食材分类字典表';
ALTER TABLE `ejia_ingredient_alt` COMMENT '食材替代关系表';
ALTER TABLE `ejia_dish_ingredient` COMMENT '菜品-食材关联表';

-- 健康管理表
ALTER TABLE `ejia_allergen_tbl` COMMENT '过敏源字典表';
ALTER TABLE `ejia_member_allergen` COMMENT '成员过敏源记录表';
ALTER TABLE `ejia_member_checkup` COMMENT '成员体检指标记录表';
ALTER TABLE `ejia_member_goal` COMMENT '成员健康目标表';
ALTER TABLE `ejia_member_diet_need` COMMENT '成员饮食需求表';

-- 食谱管理表
ALTER TABLE `ejia_recipe` COMMENT '食谱基本信息表';
ALTER TABLE `ejia_recipe_ingredient` COMMENT '食谱-食材关联表';
ALTER TABLE `ejia_recipe_allergen` COMMENT '食谱过敏源信息表';

-- 餐饮计划表
ALTER TABLE `ejia_meal_plan` COMMENT '餐饮计划表';
ALTER TABLE `ejia_meal_plan_recipe` COMMENT '计划-食谱关联表';
ALTER TABLE `ejia_daily_order` COMMENT '每日点餐记录表';
ALTER TABLE `ejia_member_daily_target` COMMENT '成员每日营养目标表';

-- 饮食记录表
ALTER TABLE `ejia_member_diet_history` COMMENT '成员饮食历史记录表';
ALTER TABLE `ejia_member_diet_taboo` COMMENT '成员饮食禁忌表';

------1. 用户相关表

-- APP用户表
ALTER TABLE `ejia_app_user`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '用户唯一标识',
MODIFY `phone` varchar(20) DEFAULT NULL COMMENT '手机号码',
MODIFY `nickname` varchar(30) DEFAULT NULL COMMENT '用户昵称',
MODIFY `avatar_url` text COMMENT '头像URL地址',
MODIFY `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间';

-- 用户家庭成员表
ALTER TABLE `ejia_user_family`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '成员唯一标识',
MODIFY `owner_id` int DEFAULT NULL COMMENT '所属用户ID',
MODIFY `relation` varchar(20) DEFAULT NULL COMMENT '与用户关系（本人、配偶、子女等）',
MODIFY `name` varchar(30) DEFAULT NULL COMMENT '成员姓名',
MODIFY `birthday` date DEFAULT NULL COMMENT '出生日期',
MODIFY `gender` smallint DEFAULT NULL COMMENT '性别：0-女，1-男',
MODIFY `height_cm` smallint DEFAULT NULL COMMENT '身高（厘米）',
MODIFY `weight_kg` decimal(4,1) DEFAULT NULL COMMENT '体重（千克）',
MODIFY `pal` decimal(3,2) DEFAULT NULL COMMENT '身体活动水平系数',
MODIFY `member_id` int DEFAULT NULL COMMENT '成员内部ID';
---------2. 菜品管理表

-- 菜品分类字典表
ALTER TABLE `ejia_dish_category`
MODIFY `id` smallint NOT NULL AUTO_INCREMENT COMMENT '分类ID',
MODIFY `name` varchar(30) NOT NULL COMMENT '分类名称';

-- 菜品基本信息表
ALTER TABLE `ejia_dish`
MODIFY `id` int NOT NULL AUTO_INCREMENT COMMENT '菜品ID',
MODIFY `name` varchar(50) NOT NULL COMMENT '菜品名称',
MODIFY `emoji` varchar(10) DEFAULT NULL COMMENT '菜品表情符号标识',
MODIFY `category_id` smallint DEFAULT NULL COMMENT '菜品分类ID',
MODIFY `description` varchar(255) DEFAULT NULL COMMENT '菜品描述',
MODIFY `rating` decimal(2,1) DEFAULT NULL COMMENT '评分（0-5分）',
MODIFY `default_portion_g` int DEFAULT '100' COMMENT '默认份量（克）',
MODIFY `max_servings` int DEFAULT '4' COMMENT '最大供应份数';

-- 套餐模板表
ALTER TABLE `ejia_combo`
MODIFY `id` int NOT NULL AUTO_INCREMENT COMMENT '套餐ID',
MODIFY `combo_name` varchar(50) NOT NULL COMMENT '套餐名称',
MODIFY `combo_desc` varchar(255) DEFAULT NULL COMMENT '套餐描述',
MODIFY `meal_type` enum('breakfast','lunch','dinner') DEFAULT NULL COMMENT '餐类型：早餐、午餐、晚餐',
MODIFY `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间';

-- 套餐-菜品关联表
ALTER TABLE `ejia_combo_item`
MODIFY `combo_id` int NOT NULL COMMENT '套餐ID',
MODIFY `dish_id` int NOT NULL COMMENT '菜品ID';
-------3. 食材营养表

-- 食材分类字典表
ALTER TABLE `ejia_ingredient_category`
MODIFY `id` smallint NOT NULL AUTO_INCREMENT COMMENT '分类ID',
MODIFY `name` varchar(30) NOT NULL COMMENT '分类名称';

-- 食材营养成分表
ALTER TABLE `ejia_ingredient`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '食材ID',
MODIFY `name` varchar(100) DEFAULT NULL COMMENT '食材名称',
MODIFY `edible_ratio` decimal(10,0) DEFAULT '1' COMMENT '可食部比例',
MODIFY `kcal` decimal(10,0) DEFAULT NULL COMMENT '热量（千卡）',
MODIFY `protein` decimal(10,0) DEFAULT NULL COMMENT '蛋白质（克）',
MODIFY `fat` decimal(10,0) DEFAULT NULL COMMENT '脂肪（克）',
MODIFY `carbs` decimal(10,0) DEFAULT NULL COMMENT '碳水化合物（克）',
MODIFY `sfa` decimal(10,0) DEFAULT NULL COMMENT '饱和脂肪酸（克）',
MODIFY `pufa` decimal(10,0) DEFAULT NULL COMMENT '多不饱和脂肪酸（克）',
MODIFY `cholesterol` decimal(10,0) DEFAULT NULL COMMENT '胆固醇（毫克）',
MODIFY `sodium` decimal(10,0) DEFAULT NULL COMMENT '钠（毫克）',
MODIFY `potassium` decimal(10,0) DEFAULT NULL COMMENT '钾（毫克）',
MODIFY `purine` decimal(10,0) DEFAULT NULL COMMENT '嘌呤（毫克）',
MODIFY `fiber` decimal(10,0) DEFAULT NULL COMMENT '膳食纤维（克）',
MODIFY `gi` decimal(10,0) DEFAULT NULL COMMENT '血糖生成指数',
MODIFY `iron` decimal(10,0) DEFAULT NULL COMMENT '铁（毫克）',
MODIFY `folate` decimal(10,0) DEFAULT NULL COMMENT '叶酸（微克）',
MODIFY `vit_c` decimal(10,0) DEFAULT NULL COMMENT '维生素C（毫克）',
MODIFY `calcium` decimal(10,0) DEFAULT NULL COMMENT '钙（毫克）',
MODIFY `collagen` decimal(10,0) DEFAULT NULL COMMENT '胶原蛋白（克）',
MODIFY `melanin_boost` decimal(10,0) DEFAULT NULL COMMENT '黑色素促进指数',
MODIFY `category_id` smallint DEFAULT NULL COMMENT '食材分类ID',
MODIFY `emoji` varchar(10) DEFAULT NULL COMMENT '食材表情符号';

-- 菜品-食材关联表
ALTER TABLE `ejia_dish_ingredient`
MODIFY `dish_id` int NOT NULL COMMENT '菜品ID',
MODIFY `ingredient_id` int NOT NULL COMMENT '食材ID',
MODIFY `amount_grams` int DEFAULT NULL COMMENT '用量（克）';

-- 食材替代关系表
ALTER TABLE `ejia_ingredient_alt`
MODIFY `ingredient_id` int NOT NULL COMMENT '原食材ID',
MODIFY `alt_id` int NOT NULL COMMENT '替代食材ID';
-----------4. 健康管理表

-- 成员过敏源记录表
ALTER TABLE `ejia_member_allergen`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `member_id` int DEFAULT NULL COMMENT '成员ID',
MODIFY `allergen_code` varchar(20) DEFAULT NULL COMMENT '过敏源代码',
MODIFY `severity` smallint DEFAULT NULL COMMENT '严重程度（1-5级）';

-- 成员体检指标表
ALTER TABLE `ejia_member_checkup`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `member_id` int DEFAULT NULL COMMENT '成员ID',
MODIFY `item_code` varchar(20) DEFAULT NULL COMMENT '体检项目代码',
MODIFY `value` decimal(10,0) DEFAULT NULL COMMENT '检测数值',
MODIFY `test_date` date DEFAULT NULL COMMENT '检测日期';

-- 饮食需求基表
ALTER TABLE `ejia_diet_need_tbl`
MODIFY `code` varchar(20) NOT NULL COMMENT '需求代码',
MODIFY `name` varchar(30) DEFAULT NULL COMMENT '需求名称',
MODIFY `icon` varchar(10) DEFAULT NULL COMMENT '图标标识',
MODIFY `desc_text` text COMMENT '需求描述';

-- 成员饮食需求表
ALTER TABLE `ejia_member_diet_need`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `member_id` int DEFAULT NULL COMMENT '成员ID',
MODIFY `need_type` varchar(20) DEFAULT NULL COMMENT '需求类型（goal-目标，checkup-体检）',
MODIFY `need_code` varchar(20) DEFAULT NULL COMMENT '需求代码';

-- 饮食需求营养成分控制表
ALTER TABLE `ejia_member_diet_need_nutrient`
MODIFY `code` varchar(20) DEFAULT NULL COMMENT '需求代码',
MODIFY `nutrient` varchar(20) DEFAULT NULL COMMENT '营养成分',
MODIFY `direction` smallint DEFAULT NULL COMMENT '控制方向（1-增加，-1-减少）',
MODIFY `threshold` decimal(10,0) DEFAULT NULL COMMENT '阈值',
MODIFY `member_id` int DEFAULT NULL COMMENT '成员ID',
MODIFY `need_code` varchar(20) DEFAULT NULL COMMENT '需求代码';

-- 个人目标基表
ALTER TABLE `ejia_enum_goal_tbl`
MODIFY `code` varchar(20) DEFAULT NULL COMMENT '目标代码',
MODIFY `name` text COMMENT '目标名称';

-- 成员健康目标表
ALTER TABLE `ejia_member_goal`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `family_id` int DEFAULT NULL COMMENT '家庭ID',
MODIFY `goal_code` varchar(20) DEFAULT NULL COMMENT '目标代码',
MODIFY `weight` decimal(10,0) DEFAULT '1' COMMENT '权重（1-100）';
------5. 食谱管理表

-- 食谱基本信息表
ALTER TABLE `ejia_recipe`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '食谱ID',
MODIFY `name` varchar(100) DEFAULT NULL COMMENT '食谱名称',
MODIFY `description` text COMMENT '食谱描述',
MODIFY `cuisine_type` varchar(30) DEFAULT NULL COMMENT '菜系类型',
MODIFY `cooking_method` varchar(30) DEFAULT NULL COMMENT '烹饪方法',
MODIFY `prep_time_min` smallint DEFAULT NULL COMMENT '准备时间（分钟）',
MODIFY `image_url` text COMMENT '图片URL',
MODIFY `is_vegan` tinyint(1) DEFAULT '0' COMMENT '是否素食（0-否，1-是）',
MODIFY `is_halal` tinyint(1) DEFAULT '0' COMMENT '是否清真（0-否，1-是）';

-- 食谱-食材关联表
ALTER TABLE `ejia_recipe_ingredient`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `recipe_id` int DEFAULT NULL COMMENT '食谱ID',
MODIFY `ingredient_id` int DEFAULT NULL COMMENT '食材ID',
MODIFY `net_weight_g` decimal(10,0) DEFAULT NULL COMMENT '净重（克）',
MODIFY `note` text COMMENT '备注';

-- 食谱过敏源信息表
ALTER TABLE `ejia_recipe_allergen`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `recipe_id` int DEFAULT NULL COMMENT '食谱ID',
MODIFY `allergen_code` varchar(20) DEFAULT NULL COMMENT '过敏源代码';
--------6. 餐饮计划表

-- 餐饮计划表
ALTER TABLE `ejia_meal_plan`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '计划ID',
MODIFY `name` varchar(100) DEFAULT NULL COMMENT '计划名称',
MODIFY `target_family_ids` json DEFAULT NULL COMMENT '目标家庭ID集合',
MODIFY `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间';

-- 计划-食谱关联表
ALTER TABLE `ejia_meal_plan_recipe`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `meal_plan_id` int DEFAULT NULL COMMENT '餐饮计划ID',
MODIFY `recipe_id` int DEFAULT NULL COMMENT '食谱ID',
MODIFY `meal_type` smallint DEFAULT NULL COMMENT '餐类型（1-早餐，2-午餐，3-晚餐）',
MODIFY `serving_order` smallint DEFAULT NULL COMMENT '上菜顺序';

-- 每日点餐记录表
ALTER TABLE `ejia_daily_order`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '订单ID',
MODIFY `family_id` int DEFAULT NULL COMMENT '家庭ID',
MODIFY `order_date` date DEFAULT NULL COMMENT '订单日期',
MODIFY `recipe_id` int DEFAULT NULL COMMENT '食谱ID',
MODIFY `meal_type` smallint DEFAULT NULL COMMENT '餐类型',
MODIFY `actual_portion` decimal(10,0) DEFAULT '1' COMMENT '实际份数';

-- 成员每日营养目标表
ALTER TABLE `ejia_member_daily_target`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `family_id` int DEFAULT NULL COMMENT '家庭ID',
MODIFY `target_date` date DEFAULT NULL COMMENT '目标日期',
MODIFY `kcal` decimal(10,0) DEFAULT NULL COMMENT '热量目标（千卡）',
MODIFY `protein` decimal(10,0) DEFAULT NULL COMMENT '蛋白质目标（克）',
MODIFY `fat` decimal(10,0) DEFAULT NULL COMMENT '脂肪目标（克）',
MODIFY `carbs` decimal(10,0) DEFAULT NULL COMMENT '碳水化合物目标（克）',
MODIFY `fiber` decimal(10,0) DEFAULT NULL COMMENT '膳食纤维目标（克）',
MODIFY `sodium` decimal(10,0) DEFAULT NULL COMMENT '钠目标（毫克）',
MODIFY `potassium` decimal(10,0) DEFAULT NULL COMMENT '钾目标（毫克）',
MODIFY `calcium` decimal(10,0) DEFAULT NULL COMMENT '钙目标（毫克）',
MODIFY `iron` decimal(10,0) DEFAULT NULL COMMENT '铁目标（毫克）',
MODIFY `vit_c` decimal(10,0) DEFAULT NULL COMMENT '维生素C目标（毫克）';
-------7. 饮食记录表

-- 成员饮食历史记录表
ALTER TABLE `ejia_member_diet_history`
MODIFY `id` bigint NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `member_id` int NOT NULL COMMENT '成员ID',
MODIFY `dish_id` int DEFAULT NULL COMMENT '菜品ID',
MODIFY `combo_id` int DEFAULT NULL COMMENT '套餐ID',
MODIFY `eat_date` date DEFAULT NULL COMMENT '用餐日期',
MODIFY `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间';

-- 成员饮食禁忌表
ALTER TABLE `ejia_member_diet_taboo`
MODIFY `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT '记录ID',
MODIFY `family_id` int DEFAULT NULL COMMENT '家庭ID',
MODIFY `taboo_type` varchar(30) DEFAULT NULL COMMENT '禁忌类型',
MODIFY `note` text COMMENT '禁忌说明';
------8. 枚举字典表

-- 过敏源基表
ALTER TABLE `ejia_allergen_tbl`
MODIFY `code` varchar(20) DEFAULT NULL COMMENT '过敏源代码',
MODIFY `name` text COMMENT '过敏源名称';

-- 体检项目基表
ALTER TABLE `ejia_enum_checkup_item_tbl`
MODIFY `code` varchar(20) DEFAULT NULL COMMENT '项目代码',
MODIFY `name` text COMMENT '项目名称',
MODIFY `unit` text COMMENT '单位',
MODIFY `risk_dir` smallint DEFAULT NULL COMMENT '风险方向（1-偏高风险，-1-偏低风险）';