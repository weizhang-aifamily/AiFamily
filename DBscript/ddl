CREATE TABLE `family_member` (
  `member_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '成员ID',
  `family_id` int(11) NOT NULL COMMENT '所属家庭ID',
  `name` varchar(50) NOT NULL COMMENT '成员姓名',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `gender` tinyint(1) NOT NULL COMMENT '性别(0-女 1-男 2-其他)',
  `birth_date` date NOT NULL COMMENT '出生日期',
  `relation` varchar(20) NOT NULL COMMENT '家庭关系(父亲/母亲/儿子...)',
  `is_primary` tinyint(1) DEFAULT '0' COMMENT '是否主要管理成员(0-否 1-是)',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` tinyint(1) DEFAULT '0' COMMENT '删除标记(0-正常 1-删除)',
  PRIMARY KEY (`member_id`),
  KEY `idx_family` (`family_id`),
  KEY `idx_primary` (`family_id`, `is_primary`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='家庭成员基础信息表';
CREATE TABLE `health_metric_type` (
  `metric_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '指标类型ID',
  `metric_code` varchar(50) NOT NULL COMMENT '指标编码(英文唯一键)',
  `metric_name` varchar(50) NOT NULL COMMENT '指标名称(如:钙含量)',
  `unit` varchar(20) NOT NULL COMMENT '计量单位(如:mg/%)',
  `normal_range` varchar(100) DEFAULT NULL COMMENT '正常范围(如:20-80)',
  `description` varchar(255) DEFAULT NULL COMMENT '指标说明',
  `is_system` tinyint(1) DEFAULT '1' COMMENT '是否系统预设(0-自定义 1-系统)',
  `display_order` int(11) DEFAULT '0' COMMENT '展示顺序',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`metric_id`),
  UNIQUE KEY `uk_code` (`metric_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='健康指标类型表';
CREATE TABLE `member_health_metric` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '记录ID',
  `member_id` int(11) NOT NULL COMMENT '成员ID',
  `metric_id` int(11) NOT NULL COMMENT '指标类型ID',
  `metric_value` decimal(10,2) NOT NULL COMMENT '指标数值',
  `measure_time` datetime NOT NULL COMMENT '测量时间',
  `data_source` varchar(20) DEFAULT 'MANUAL' COMMENT '数据来源(MANUAL/DEVICE/IMPORT)',
  `status` varchar(20) DEFAULT NULL COMMENT '状态(NORMAL/HIGH/LOW)',
  `version` int(11) DEFAULT '1' COMMENT '数据版本',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_member_metric` (`member_id`, `metric_id`, `measure_time`),
  KEY `idx_metric` (`metric_id`),
  KEY `idx_time` (`member_id`, `measure_time`),
  CONSTRAINT `fk_metric_member` FOREIGN KEY (`member_id`) REFERENCES `family_member` (`member_id`),
  CONSTRAINT `fk_metric_type` FOREIGN KEY (`metric_id`) REFERENCES `health_metric_type` (`metric_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='成员健康指标记录表';
CREATE TABLE `member_health_snapshot` (
  `snapshot_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '快照ID',
  `member_id` int(11) NOT NULL COMMENT '成员ID',
  `snapshot_time` datetime NOT NULL COMMENT '快照时间',
  `metric_json` json NOT NULL COMMENT '指标数据JSON',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`snapshot_id`),
  KEY `idx_member` (`member_id`),
  KEY `idx_time` (`snapshot_time`),
  CONSTRAINT `fk_snapshot_member` FOREIGN KEY (`member_id`) REFERENCES `family_member` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='成员健康指标快照表';
-- 食物表
CREATE TABLE foods (
    food_id INT AUTO_INCREMENT PRIMARY KEY,
    food_name VARCHAR(50) NOT NULL,
    calories INT,
    sodium INT,
    description TEXT
);

-- 食物标签表
CREATE TABLE food_tags (
    id INT AUTO_INCREMENT PRIMARY KEY,
    food_id INT NOT NULL,
    tag_name VARCHAR(30) NOT NULL,
    FOREIGN KEY (food_id) REFERENCES foods(food_id)
);

-- 成员饮食记录表
CREATE TABLE member_food_log (
    log_id INT AUTO_INCREMENT PRIMARY KEY,
    member_id INT NOT NULL,
    food_id INT NOT NULL,
    consumed_at DATETIME NOT NULL,
    servings FLOAT,
    FOREIGN KEY (member_id) REFERENCES family_member(member_id),
    FOREIGN KEY (food_id) REFERENCES foods(food_id)
);