过敏原与食材的对应关系：
SELECT DISTINCT allergen_code
FROM ejia_member_allergen
WHERE member_id IN (1,2,3,4);
2、营养区间是否可实现
SELECT nutrient_code,
       SUM(min_need_qty) AS min_total,
       SUM(max_need_qty) AS max_total
FROM ejia_member_daily_nutrient_actual
WHERE member_id IN (1,2,3,4)
GROUP BY nutrient_code;
3、把“已声明需求”+“外部推断需求”合并   额外需求能否取到合适的菜？
SELECT
    um.id AS member_id,
    COALESCE(
        (SELECT GROUP_CONCAT(DISTINCT dmn.need_code)
         FROM ejia_member_diet_need dmn
         WHERE dmn.member_id = um.id), ''
    ) AS declared_needs,
    COALESCE(
        (SELECT GROUP_CONCAT(DISTINCT ec.code)
         FROM ejia_enum_diet_need_tbl ec
         WHERE ec.is_external = 1
            OR ec.code IN (
                CASE
                    WHEN um.age BETWEEN 3 AND 12 THEN 'CHILD'
                    WHEN um.age < 3 THEN 'TODDLER'
                    ELSE 'ADULT'
                END
            )), ''
    ) AS external_needs
FROM ejia_user_family_member um
WHERE um.id IN (1,2,3,4);

------------------------------------------------
2. 过敏原检查只到 food 级，漏掉「复合调料」
------------------------------------------------
- 表现：豆瓣酱本身不过敏，但里面的「小麦」是过敏原，系统没拦住。
- 原因：`get_dish_allergens` 只查 `ejia_allergen_food_rel`，没有拆配料表。
- 改进：把调料也当成 food_id，再查一次
```sql
SELECT DISTINCT ar.allergen_code
FROM ejia_allergen_food_rel ar
JOIN ejia_dish_food_rel dfr ON dfr.food_id = ar.food_id
JOIN foods f ON f.fdc_id = dfr.food_id
WHERE dfr.dish_id = ? AND f.description LIKE '%酱%'
```


------------------------------------------------
6. 早/午/晚营养比例写死，不符合「健身人群」
------------------------------------------------
- 表现：健身增肌想把午餐蛋白提到 50%，系统仍是 40%。
- 原因：
```python
nutrient_ratio_lunch = 0.4
```
- 改进：把比例做成入参
```python
meal_ratios = custom_ratios or CONFIG.nutrient_ratio_lunch
```
调用时允许
```json
{"lunch":0.5,"dinner":0.3,"breakfast":0.2}
```

```
8、 对老人、减脂人群、健身人群、过敏体质、视觉体验都会更合理，而接口签名保持不变。